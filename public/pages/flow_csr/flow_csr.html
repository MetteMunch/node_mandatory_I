<!doctype html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <title>Flow og opbygning - CSR Client-side Rendering</title>
    <link rel="stylesheet" href="../../assets/css/style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="content">
      <h1>Flow og opbygning - CSR Client-side rendering</h1>

      <p>
        Med udgangspunkt i en lille vejr applikation
        <strong>Node.js (Express)</strong>, vil jeg pr√∏ve at beskrive
        opbygningen af applikationen samt hvad sker hvor (client-side og
        server-side).
      </p>
      <br />

      <h2>1Ô∏è‚É£ Bruger kalder <code>/weather/:city</code></h2>
      <p>
        Bruger g√•r ind p√• fx
        <code>http://localhost:8080/weather/k√∏benhavn</code>. Denne route
        h√•ndteres i vores app.js under PAGES eller i en s√¶rskilt
        <strong>page-router</strong> js fil p√• serveren:
      </p>

      <pre><code class="language-javascript">
    // under PAGES i app.js

    app.get("/weather/:city", (req, res) => {
    res.sendFile("/public/pages/weather.html");
    });
    </code></pre>

      <p>
        Serveren returnerer HTML-siden <code>weather.html</code> fra
        <code>public/pages</code>-mappen.
      </p>

      <h2>2Ô∏è‚É£ Client-side loader <code>weather.js</code></h2>
      <p>
        Inde i <code>weather.html</code> indl√¶ses et script, som h√•ndterer
        klientlogikken. Dette script er ogs√• gemt under public, fx i en js
        folder eller en folder der indeholder alt vedr. "weather" (b√•de html, js
        og evt specifik css).
      </p>

      <h2>3Ô∏è‚É£ Scriptet <code>weather.js</code> kalder API'et p√• serveren</h2>
      <p>
        Scriptet kalder <code>`/api/weather/${city}`</code> routen, som enten
        findes i app.js under API'ER eller i en s√¶rskilt
        <strong>api-router</strong> fil p√• serveren.
      </p>

      <pre><code class="language-javascript">
    // weather.js
    document.addEventListener("DOMContentLoaded", async () => {
    const city = window.location.pathname.split("/").pop();
    document.getElementById("city").textContent = city;

    const response = await fetch(`/api/weather/${city}`);
    const data = await response.json();

    document.getElementById("temp").textContent = data.CurrentData.temperature + "¬∞C";
    });
    </code></pre>

      <h2>4Ô∏è‚É£ Serverens API-route h√•ndterer <code>/api/weather/:city</code></h2>

      <pre><code class="language-javascript">
    //under API i app.js
    
    import { getWeather } from "../utils/weatherUtil.js";
    
    app.get("/weather/:city", async (req, res) => {
    const city = req.params.city;
    const weather = await getWeather(city);
    res.send({data: weather});
    });
    </code></pre>

      <h2>
        5Ô∏è‚É£ Serverens <code>weatherUtil.js</code> henter data fra ekstern API
      </h2>

      <pre><code class="language-javascript">
    // utils/weatherUtil.js

    export async function getWeather(city) {
    const url = `https://vejr.eu/api.php?location=${city}&degree=C`;
    const response = await fetch(url);
    const data = await response.json();
    return data;
    }
    </code></pre>
      <br />

      <h2>üìò Samlet flow (kort fortalt)</h2>
      <img src="/assets/images/flow.jpg" alt="flow" /><br />

      <table>
        <thead>
          <tr>
            <th>Trin</th>
            <th>Hvad sker der</th>
            <th>Hvor</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>Bruger √•bner <code>/weather/k√∏benhavn</code></td>
            <td>Client ‚Üí Server</td>
          </tr>
          <tr>
            <td>2</td>
            <td>Server returnerer <code>weather.html</code></td>
            <td>Server</td>
          </tr>
          <tr>
            <td>3</td>
            <td>Browser loader <code>weather.js</code></td>
            <td>Client</td>
          </tr>
          <tr>
            <td>4</td>
            <td>
              <code>weather.js</code> kalder <code>/api/weather/k√∏benhavn</code>
            </td>
            <td>Client ‚Üí Server</td>
          </tr>
          <tr>
            <td>5</td>
            <td>Server kalder ekstern vejr-API</td>
            <td>Server</td>
          </tr>
          <tr>
            <td>6</td>
            <td>Browser viser data</td>
            <td>Client</td>
          </tr>
        </tbody>
      </table>
      <br />

      <a class="back" href="/">‚¨Ö Tilbage til opslagstavlen</a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-html.min.js"></script>
  </body>
</html>
